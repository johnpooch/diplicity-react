{
  "permissions": {
    "allow": [
      "Bash(python3 -m pytest game/tests/test_orderable_provinces_list.py::test_list_orderable_provinces_after_creating_order game/tests/test_orderable_provinces_list.py::test_list_orderable_provinces_after_updating_order -v)",
      "Bash(python3 -m pytest game/tests/test_orderable_provinces_list.py game/tests/test_interactive_order_create.py game/tests/test_order_list.py -v)",
      "Bash(docker compose run:*)",
      "Bash(npm run lint)",
      "Bash(grep:*)",
      "Bash(python3:*)",
      "Bash(git log:*)",
      "Bash(docker compose:*)",
      "Bash(npm install:*)",
      "Bash(npm run build:*)",
      "Bash(cat:*)",
      "Bash(npm run dev:*)",
      "Bash(npx shadcn@latest add:*)",
      "Bash(npx shadcn@latest diff:*)",
      "Bash(nvm use)",
      "Bash(npm --version:*)",
      "Bash(node --version:*)",
      "Bash(npx --version:*)",
      "Bash(npm run lint:*)",
      "Bash(npm run typecheck:*)",
      "Bash(npx tsc:*)",
      "Bash(npm run codegen:react-query:*)",
      "Bash(source ~/.nvm/nvm.sh)",
      "Bash(nvm use:*)",
      "Bash(npx orval:*)",
      "Bash(npm run storybook:*)",
      "WebFetch(domain:github.com)",
      "WebFetch(domain:forum.cursor.com)",
      "WebFetch(domain:shadcn-chat.vercel.app)",
      "WebFetch(domain:raw.githubusercontent.com)",
      "WebFetch(domain:ai-sdk.dev)",
      "WebFetch(domain:www.prompt-kit.com)",
      "WebFetch(domain:elements.ai-sdk.dev)",
      "WebFetch(domain:api.github.com)",
      "Bash(for file in AppBar GameCard InfoPanel MemberAvatar MemberAvatarGroup Notice GameDetailLayout)",
      "Bash(do)",
      "Bash(done)",
      "WebFetch(domain:ui.shadcn.com)",
      "Bash(ANALYZE=true npm run build:*)",
      "Bash(node -e:*)",
      "Bash(gh issue create --title \"Display supply center count on nation accordion header in Orders screen\" --body \"$\\(cat <<''EOF''\n## Summary\n\nAdd supply center \\(SC\\) count display to the nation accordion headers in the Orders screen, giving players quick visibility into each nation''s standing without navigating to Player Info.\n\n## Current State\n\n- SC counts are calculated and displayed in `PlayerInfoContent.tsx` using the `getSupplyCenterCount` helper\n- The Orders screen \\(`OrdersScreen.tsx`\\) shows nation accordions with avatar and nation name only\n- Players must navigate to Player Info to see SC counts\n\n## Proposed Implementation\n\nUpdate the accordion trigger in `OrdersScreen.tsx` to include SC count:\n\n**Current:**\n```\n[Avatar] Germany\n```\n\n**Proposed:**\n```\n[Avatar] Germany • ⭐ 3\n```\n\n### Technical Details\n\n1. The `phase` object is already available in `OrdersScreen` and contains `supplyCenters` array\n2. Filter `phase.supplyCenters` by nation name to get count \\(same logic as `PlayerInfoContent.tsx`\\)\n3. Display count with star icon next to nation name in `AccordionTrigger`\n\n### Key Consideration\n\nFor historical phases, the SC count should reflect that phase''s state \\(not current phase\\). The existing code already scopes `phase` to the selected phase via `useGamePhaseRetrieveSuspense\\(gameId, selectedPhase\\)`, so this should work correctly.\n\n## Files to Modify\n\n- `packages/web/src/screens/GameDetail/OrdersScreen.tsx`\n\n## Acceptance Criteria\n\n- [ ] SC count displayed on each nation''s accordion header\n- [ ] Count updates correctly when navigating between phases\n- [ ] Visual style matches existing SC display in Player Info \\(star icon\\)\nEOF\n\\)\")",
      "Bash(gh issue create:*)",
      "Bash(gh issue edit 122 --body \"$\\(cat <<''EOF''\n## Summary\n\nAutomatically detect games where no players are submitting orders and mark them as abandoned. This prevents games from running indefinitely when all players have lost interest.\n\n## Current State\n\n- Games continue resolving phases even when no orders are submitted\n- No mechanism to detect or handle abandoned games\n- Games can only end via victory \\(solo or draw\\)\n\n## Proposed Implementation\n\n### New Game Status\n\nAdd `ABANDONED` to game status choices:\n\n```python\nclass GameStatus:\n    PENDING = \"pending\"\n    ACTIVE = \"active\"\n    COMPLETED = \"completed\"\n    ABANDONED = \"abandoned\"  # NEW\n```\n\n### Abandonment Detection Criteria\n\nA game is considered abandoned when:\n- **No orders submitted by any player for 2 consecutive phases**\n\nThis is checked automatically during phase resolution.\n\n### Automatic Detection \\(Runtime\\)\n\nDuring phase resolution job:\n1. After resolving a phase, check if previous 2 phases had zero orders from all players\n2. If criteria met → mark game as `ABANDONED`\n3. Abandoned games stop resolving further phases\n\n**Location:** Add check in resolution management command or phase resolution logic.\n\n**Note:** Existing abandoned games in the database will naturally be marked as abandoned when their next phase resolves. No migration cleanup is needed.\n\n### Frontend Handling\n\n- Abandoned games shown in \"Finished\" tab \\(or separate \"Abandoned\" section\\)\n- Visual indicator: grayed out, \"Abandoned\" badge\n- Abandoned games don''t count toward player stats/records \\(if stats are implemented\\)\n\n## Files to Modify\n\n### Backend\n- `service/common/constants.py` - add ABANDONED status\n- `service/game/models.py` - update status choices\n- `service/game/management/commands/` - add check to resolution command\n\n### Frontend\n- `packages/web/src/screens/Home/MyGames.tsx` - handle abandoned status in tabs\n- `packages/web/src/components/GameCard.tsx` - visual treatment for abandoned games\n\n## Edge Cases\n\n- **Game abandoned mid-phase**: Not possible - check happens at phase resolution\n- **Single player abandons**: Separate issue \\(player ghosting\\) - not addressed here\n- **Sandbox games**: Should sandbox games be subject to abandonment? Probably not since they have no time pressure\n\n## Acceptance Criteria\n\n- [ ] New `ABANDONED` game status added\n- [ ] Games auto-marked as abandoned after 2 phases with no orders\n- [ ] Abandoned games stop resolving new phases\n- [ ] Frontend displays abandoned games appropriately\n- [ ] Sandbox games excluded from abandonment detection\nEOF\n\\)\")",
      "WebFetch(domain:orval.dev)",
      "WebFetch(domain:drf-spectacular.readthedocs.io)"
    ],
    "deny": [],
    "ask": []
  }
}
